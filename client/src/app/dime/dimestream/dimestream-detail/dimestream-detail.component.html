<div class="box box-primary">
	<div class="box-header with-border">
		<h3 class="box-title">Edit Stream: {{curStream.name}}</h3>
	</div>
	<div class="box-header">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#streamtabmaindefinitions" data-toggle="tab">Main Definitions</a></li>
			<li><a href="#streamtabfields" data-toggle="tab">Fields</a></li>
			<li><a href="#streamtabfielddescriptiontables" data-toggle="tab">Field Description Tables</a></li>
		</ul>
	</div>
	<div class="box-body">
		<div class="tab-content">
			<div class="tab-pane fade in active" id="streamtabmaindefinitions">
				<form (ngSubmit)="streamSave(f)" #f="ngForm" class="form-horizontal">
					<fieldset>
						<div class="form-group">
							<label for="streamID" class="col-xs-2 control-label">ID:</label>
							<div class="col-xs-10">
								<input type="text" class="form-control" id="streamID" name="streamID" [(ngModel)]="curStream.id" disabled>
							</div>
						</div>
						<div class="form-group">
							<label for="streamName" class="col-xs-2 control-label">Name:</label>
							<div class="col-xs-10">
								<input type="text" class="form-control" id="streamName" name="streamName" [(ngModel)]="curStream.name">
							</div>
						</div>
						<div class="form-group">
							<label for="streamType" class="col-xs-2 control-label">Type:</label>
							<div class="col-xs-10">
								<select name="streamType" id="streamType" class="form-control" [(ngModel)]="curStream.type">
							<option *ngFor="let streamType of streamTypeList" [value]="streamType.id">{{streamType.name}}</option>
						</select>
							</div>
						</div>
						<div class="form-group">
							<label for="streamEnvironment" class="col-xs-2 control-label">Environment:</label>
							<div class="col-xs-10">
								<!--<input type="text" class="form-control" id="streamEnvironment" name="streamEnvironment" [(ngModel)]="curStream.environment" required>-->
								<select name="streamEnvironment" id="streamEnvironment" class="form-control" [(ngModel)]="curStream.environment" (change)="curStreamClean=false;">
							<option *ngFor="let environment of environmentList" [value]="environment.id">{{environment.name}}</option>
						</select>
							</div>
						</div>
						<div class="form-group">
							<label for="streamDB" class="col-xs-2 control-label" *ngIf="!curStreamEnvironmentType">Database Name:</label>
							<label for="streamDB" class="col-xs-2 control-label" *ngIf="curStreamEnvironmentType=='MSSQL'">Database Name:</label>
							<label for="streamDB" class="col-xs-2 control-label" *ngIf="curStreamEnvironmentType=='HP'">Application Name:</label>
							<label for="streamDB" class="col-xs-2 control-label" *ngIf="curStreamEnvironmentType=='PBCS'">Application Name:</label>
							<div class="col-xs-10">
								<div class="input-group">
									<select name="streamDB" id="streamDB" class="form-control" [(ngModel)]="curStream.dbName" (change)="curStreamClean=false;">
								<option *ngFor="let selectableDB of databaseList" [value]="selectableDB.name">{{selectableDB.name}}</option>
							</select>
									<span class="input-group-btn">
								<button class="btn btn-default" type="button" [disabled]="curStream.environment < 1 || !curStreamClean" (click)="streamRefreshDatabases()">Refresh</button>
							</span>
								</div>
								<span class="help-block" *ngIf="curStream.environment < 1">
							<div class="well well-warning well-sm">
									Please assign an environment to be able to change the database.
							</div>
						</span>
								<span class="help-block" *ngIf="!curStreamClean">
							<div class="well well-warning well-sm">
									Changes must be saved before assignment.
							</div>
						</span>
							</div>
						</div>
						<div class="form-group">
							<label for="streamTable" class="col-xs-2 control-label" *ngIf="!curStreamEnvironmentType">Table Name:</label>
							<label for="streamTable" class="col-xs-2 control-label" *ngIf="curStreamEnvironmentType=='MSSQL'">Table Name:</label>
							<label for="streamTable" class="col-xs-2 control-label" *ngIf="curStreamEnvironmentType=='HP'">Cube Name:</label>
							<label for="streamTable" class="col-xs-2 control-label" *ngIf="curStreamEnvironmentType=='PBCS'">Cube Name:</label>
							<div class="col-xs-10" *ngIf="curStreamEnvironmentType == 'PBCS'">
								<input type="text" class="form-control" id="streamTable" name="streamTable" [(ngModel)]="curStream.tableName">
								<span class="help-block" *ngIf="!curStream.dbName">
									<div class="well well-warning well-sm">
											Please assign a database/application to be able to change the tablename.
									</div>
								</span>
							</div>
							<div class="col-xs-10" *ngIf="curStreamEnvironmentType != 'PBCS'">
								<div class="input-group">
									<select name="streamTable" id="streamTable" class="form-control" [(ngModel)]="curStream.tableName" (change)="curStreamClean=false;">
										<option *ngFor="let selectableTable of tableList" [value]="selectableTable.name">{{selectableTable.name}} ({{selectableTable.type}})</option>
									</select>
									<span class="input-group-btn">
										<button class="btn btn-default" type="button" [disabled]="!curStream.dbName" (click)="streamRefreshTables()">Refresh</button>
									</span>
								</div>
								<span class="help-block" *ngIf="!curStream.dbName">
									<div class="well well-warning well-sm">
											Please assign a database to be able to change the tablename.
									</div>
								</span>
							</div>
						</div>
						<div class="form-group" *ngIf="curStreamEnvironmentType == 'MSSQL'">
							<label for="streamQuery" class="col-xs-2 control-label">Custom Query:</label>
							<div class="col-xs-10">
								<textarea name="streamQuery" id="streamQuery" rows="10" class="form-control" [(ngModel)]="curStream.customQuery" *ngIf="curStream.tableName == 'Custom Query'"></textarea>
								<input type="text" class="form-control" id="streamQuery" name="streamQuery" [(ngModel)]="curStream.customQuery" disabled
								 *ngIf="curStream.tableName != 'Custom Query'">
							</div>
						</div>
						<div class="form-group">
							<div class="col-xs-10 col-xs-offset-2">
								<button class="btn btn-primary btn-xs" type="submit"><i class="fa fa-floppy-o fa-fw"></i> Save Changes</button>
								<!--<button class="btn btn-warning btn-xs" type="button" routerLink="/dime/streams/stream-list"><i class="fa fa-ban fa-fw"></i> Cancel</button>-->
								<!--<button class="btn btn-success btn-xs" type="button" (click)="streamVerify()"><i class="fa fa-check fa-fw"></i> Verify Stream</button>-->
								<button class="btn btn-danger btn-xs pull-right" type="button" (click)="streamDelete(curStream.id)"><i class="fa fa-trash fa-fw"></i> Delete Stream</button>
							</div>
						</div>
						<!--<div class="form-group">
							<pre>{{curStreamEnvironmentType|json}}</pre>
						</div>
						<div class="form-group">
							<pre>{{curStream|json}}</pre>
						</div>
						<div class="form-group">
							<pre>{{environmentList|json}}</pre>
						</div>
						<div class="form-group">
							<pre>{{environmentTypeList|json}}</pre>
						</div>-->
					</fieldset>
				</form>
			</div>
			<div class="tab-pane fade" id="streamtabfields">
				<button *ngIf="!curStream.assignedFields" type="button" class="btn btn-default btn-xs" (click)="streamGetFields(curStream.id)">Refresh Fields from Server</button>
				<button *ngIf="curStream.sourcedFields" type="button" class="btn btn-default btn-xs" ng-click="streamAssignFields(stream)">Assign Fields</button>
				<button *ngIf="curStream.assignedFields" type="button" class="btn btn-default btn-xs" ng-click="streamFieldsStartOver(stream)">Start Over</button>
				<button *ngIf="curStream.assignedFields" type="button" class="btn btn-default btn-xs" ng-click="streamFieldsSaveChanges(stream)"><i class="fa fa-save fa-fw"></i> Save Changes</button>
				<hr *ngIf="curStream.sourcedFields  || curStream.assignedFields">
				<div *ngIf="curStream.sourcedFields && !curStream.assignedFields"> ng-include="'/etools/stream/streamsExpandedFieldsSourced.html'"</div>
				<div *ngIf="curStream.assignedFields">streamsExpandedFieldsAssigned.html</div>
			</div>
			<div class="tab-pane fade" id="streamtabfielddescriptiontables">Default 3</div>
		</div>
	</div>
</div>